# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ë–æ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ú–°–ö (Europe/Moscow). –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–∏—Å—Ç–µ–º—ã.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω –º–æ–¥—É–ª—å `bot/utils/timezone_helper.py`, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (–ú–°–ö)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
- ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–æ–∫—Ä—ã—Ç –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –í –∫–æ–¥–µ –±–æ—Ç–∞

```python
from bot.utils.timezone_helper import TimezoneHelper

# –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä
tz_helper = TimezoneHelper()

# –ü–æ–ª—É—á–∏—Ç—å –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è
msk_time = tz_helper.get_moscow_time()
print(f"–í—Ä–µ–º—è –≤ –ú–æ—Å–∫–≤–µ: {msk_time}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (07:00-20:00 –ú–°–ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
if tz_helper.is_working_hours():
    print("–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç")
else:
    print("–í–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å custom –≤—Ä–µ–º–µ–Ω–µ–º
from datetime import time

if tz_helper.is_working_hours(
    start_time=time(8, 0),   # 08:00
    end_time=time(22, 0)      # 22:00
):
    print("–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ")

# –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
status = tz_helper.get_time_status()
print(status)
# {
#     'current_time_msk': datetime(...),
#     'current_time_str': '14:30:00',
#     'is_working_hours': True,
#     'work_start': '07:00',
#     'work_end': '20:00',
#     'test_mode': False,
#     'time_check_disabled': False,
#     'timezone': 'Europe/Moscow',
#     'has_zoneinfo': True
# }

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
print(tz_helper.format_work_hours())
# üïê –†–∞–±–æ—á–∏–µ —á–∞—Å—ã: 07:00-20:00 –ú–°–ö
# üïê –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ú–°–ö: 14:30:00
# ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### TEST_MODE
–û—Ç–∫–ª—é—á–∞–µ—Ç **–≤—Å–µ** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–≤—Ä–µ–º—è, –ª–∏–º–∏—Ç—ã, –∏ —Ç.–¥.)

```bash
# Linux/Mac
export TEST_MODE=1
python bot/main_refactored.py

# Windows PowerShell
$env:TEST_MODE=1
python bot/main_refactored.py

# –í .env —Ñ–∞–π–ª–µ
TEST_MODE=1
```

#### DISABLE_TIME_CHECK
–û—Ç–∫–ª—é—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7)

```bash
# Linux/Mac
export DISABLE_TIME_CHECK=1
python bot/main_refactored.py

# Windows PowerShell
$env:DISABLE_TIME_CHECK=1
python bot/main_refactored.py

# –í .env —Ñ–∞–π–ª–µ
DISABLE_TIME_CHECK=1
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **07:00 - 20:00 –ú–°–ö**

–ò–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ:

```python
from bot.utils.timezone_helper import TimezoneHelper
from datetime import time

tz_helper = TimezoneHelper()

# –ü—Ä–∏–º–µ—Ä: 06:00 - 23:00
if tz_helper.is_working_hours(
    start_time=time(6, 0),
    end_time=time(23, 0)
):
    # –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
    pass
```

–ò–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `bot/utils/timezone_helper.py`:

```python
class TimezoneHelper:
    DEFAULT_WORK_START = time(6, 0)   # 06:00
    DEFAULT_WORK_END = time(23, 0)    # 23:00
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:

```bash
python tests/test_timezone.py
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ (–≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ (–≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞)
- ‚úÖ –†–∞–±–æ—Ç—É TEST_MODE
- ‚úÖ –†–∞–±–æ—Ç—É DISABLE_TIME_CHECK
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (07:00, 20:00, 06:59, 20:01)

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**:
```bash
# –°–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è
date

# –í—Ä–µ–º—è –≤ –ú–æ—Å–∫–≤–µ
TZ=Europe/Moscow date

# Python –ø—Ä–æ–≤–µ—Ä–∫–∞
python -c "from bot.utils.timezone_helper import TimezoneHelper; print(TimezoneHelper().format_work_hours())"
```

2. **–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É**:
```bash
# –î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
TEST_MODE=1 python bot/main_refactored.py
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**:
–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞:
- `üïê –†–∞–±–æ—á–∏–µ —á–∞—Å—ã –±–æ—Ç–∞: 7:00-20:00 –ú–°–ö`
- `üïê –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ú–°–ö: XX:XX:XX`
- `‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç` –∏–ª–∏ `‚ùå –í–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤`

### –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –º–æ–¥—É–ª—å –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Europe/Moscow`, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.

### –ù—É–∂–µ–Ω —Ä–µ–∂–∏–º 24/7

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
DISABLE_TIME_CHECK=1
```

–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å —Ñ–ª–∞–≥–æ–º:
```bash
DISABLE_TIME_CHECK=1 python bot/main_refactored.py
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+ (—Å `zoneinfo`)
- –ò–ª–∏ Python 3.7-3.8 —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º `backports.zoneinfo`

–î–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π Python:
```bash
pip install backports.zoneinfo
```

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
TEST_MODE=1 python bot/main_refactored.py
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–¥–∞–∫—à–Ω —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —á–∞—Å–∞–º–∏
```python
# –í –∫–æ–¥–µ –±–æ—Ç–∞
if tz_helper.is_working_hours(
    start_time=time(6, 0),   # 06:00
    end_time=time(23, 0)      # 23:00
):
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    pass
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –†–µ–∂–∏–º 24/7
```bash
# –í .env
DISABLE_TIME_CHECK=1
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
```python
from bot.utils.timezone_helper import TimezoneHelper

tz = TimezoneHelper()
status = tz.get_time_status()

print(f"–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è: {status['current_time_str']}")
print(f"–†–∞–±–æ—á–∏–µ —á–∞—Å—ã: {status['work_start']}-{status['work_end']}")
print(f"–°—Ç–∞—Ç—É—Å: {'–†–∞–±–æ—Ç–∞–µ—Ç' if status['is_working_hours'] else '–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç'}")
print(f"–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: {status['timezone']}")
print(f"zoneinfo –¥–æ—Å—Ç—É–ø–µ–Ω: {status['has_zoneinfo']}")
```

## FAQ

**Q: –ü–æ—á–µ–º—É –±–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ—á–µ—Ä–æ–º/–Ω–æ—á—å—é?**  
A: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç 07:00-20:00 –ú–°–ö. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `DISABLE_TIME_CHECK=1` –¥–ª—è —Ä–µ–∂–∏–º–∞ 24/7.

**Q: –í—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ, —á—Ç–æ –¥–µ–ª–∞—Ç—å?**  
A: –ù–∏—á–µ–≥–æ, –º–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –ú–°–ö.

**Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –±–æ—Ç–∞?**  
A: `python -c "from bot.utils.timezone_helper import TimezoneHelper; print(TimezoneHelper().format_work_hours())"`

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞?**  
A: –°–µ–π—á–∞—Å –Ω–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `WORK_START` –∏ `WORK_END` –≤ `.env`. –°–æ–∑–¥–∞–π—Ç–µ issue –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

**Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ "No module named 'zoneinfo'"?**  
A: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `pip install backports.zoneinfo` –¥–ª—è Python < 3.9.

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞**: 30.10.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

