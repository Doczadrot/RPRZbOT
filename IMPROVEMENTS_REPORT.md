# –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏—è—Ö –ø—Ä–æ–µ–∫—Ç–∞ RPRZ Safety Bot

**–î–∞—Ç–∞:** 2024  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** AI Assistant  
**–¶–µ–ª—å:** –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Railway sleep mode

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Railway Sleep Mode

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ Railway Free Plan –±–æ—Ç –∑–∞—Å—ã–ø–∞–ª –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ—Å—Ç–∞–≤–∞—è –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã.

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `/ping` endpoint –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–∏–Ω–≥–∞
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π keepalive –º–µ—Ö–∞–Ω–∏–∑–º —á–µ—Ä–µ–∑ threading
- ‚úÖ Keepalive –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Railway –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`RAILWAY_PUBLIC_DOMAIN`)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã keepalive

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `bot/main_webhook.py` - –¥–æ–±–∞–≤–ª–µ–Ω keepalive –º–µ—Ö–∞–Ω–∏–∑–º
- `env.example` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è keepalive
- `RAILWAY_KEEPALIVE.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ—Ç –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –∑–∞—Å—ã–ø–∞—Ç—å –Ω–∞ Railway –±–ª–∞–≥–æ–¥–∞—Ä—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –ø–∏–Ω–≥—É –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç.

### 2. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞

**–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞:** `analyze_and_improve.py`

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –º–µ–∂–¥—É `main.py` –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏:
  - –§—É–Ω–∫—Ü–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `main.py` –∏ `cache.py`
  - –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `main.py` –∏ `security.py`
  - –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `main.py` –∏ `media_processor.py`

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
- `main.py`: 2259 —Å—Ç—Ä–æ–∫, 48 —Ñ—É–Ω–∫—Ü–∏–π
- `handlers.py`: 1102 —Å—Ç—Ä–æ–∫–∏, 22 —Ñ—É–Ω–∫—Ü–∏–∏
- `main_webhook.py`: 356 —Å—Ç—Ä–æ–∫, 9 —Ñ—É–Ω–∫—Ü–∏–π (—É–ª—É—á—à–µ–Ω–æ)
- `cache.py`: 232 —Å—Ç—Ä–æ–∫–∏, 20 —Ñ—É–Ω–∫—Ü–∏–π
- `security.py`: 332 —Å—Ç—Ä–æ–∫–∏, 19 —Ñ—É–Ω–∫—Ü–∏–π
- `media_processor.py`: 219 —Å—Ç—Ä–æ–∫, 12 —Ñ—É–Ω–∫—Ü–∏–π
- `notifications.py`: 395 —Å—Ç—Ä–æ–∫, 8 —Ñ—É–Ω–∫—Ü–∏–π

## üîÑ –ó–∞–¥–∞—á–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É `main.py` –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏.

**–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**

1. **–§—É–Ω–∫—Ü–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è** (–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `main.py` –∏ `cache.py`):
   - `cache_user_data`
   - `get_cached_user_data`
   - `cache_shelter_data`
   - `get_cached_shelter_data`
   - `cleanup_cache`
   
   **–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `main.py`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ `cache.py`

2. **–§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** (–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `main.py` –∏ `security.py`):
   - `check_user_security`
   - `validate_user_text`
   - `validate_user_file`
   
   **–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `main.py`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ `security.py`

3. **–§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞** (–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `main.py` –∏ `media_processor.py`):
   - `validate_media_file`
   - `process_media_file`
   - `get_media_processing_stats`
   
   **–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `main.py`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ `media_processor.py`

4. **–§—É–Ω–∫—Ü–∏—è `set_bot_instance`** (–¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ `handlers.py` –∏ `notifications.py`):
   - –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π –º–æ–¥—É–ª—å `bot/utils.py` –¥–ª—è –æ–±—â–∏—Ö —É—Ç–∏–ª–∏—Ç
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ç—É–¥–∞

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–Ω–æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** `main_webhook.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤–µ—Å—å `main.py` –º–æ–¥—É–ª—å, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ.

**–î–µ–π—Å—Ç–≤–∏–µ:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ `main_webhook.py` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–µ–π—Å—Ç–≤–∏–µ:** 
- –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è keepalive –º–µ—Ö–∞–Ω–∏–∑–º–∞
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è endpoints
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ Railway –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

## üìã Roadmap

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (‚úÖ –í–´–ü–û–õ–ù–ï–ù–û)
- [x] –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Railway sleep mode
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ keepalive –º–µ—Ö–∞–Ω–∏–∑–º–∞
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –≠—Ç–∞–ø 2: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (üîú –°–õ–ï–î–£–Æ–©–ò–ô)
- [ ] –ê—É–¥–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ `main.py`
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ `main.py`
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ `main_webhook.py`
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è keepalive
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Railway
- [ ] –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ Keepalive –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç sleep mode
- ‚úÖ –ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –í—Å–µ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚è≥ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
- ‚è≥ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∫–æ–º–∏—Å—Å–∏–∏ (–ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞ 2)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∞–Ω—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- Keepalive –º–µ—Ö–∞–Ω–∏–∑–º –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ `RAILWAY_KEEPALIVE.md`
- –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `analyze_and_improve.py`

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ keepalive](RAILWAY_KEEPALIVE.md)
- [Railway Documentation](https://docs.railway.app)
